trigger:
  branches:
    include:
    - main
    - develop
  paths:
    exclude:
    - docs/*
    - README.md

variables:
- group: production-vars
- name: buildConfiguration
  value: Release
- name: vmImage
  value: ubuntu-latest

pool:
  vmImage: $(vmImage)

stages:
- stage: Build
  displayName: Build and Test

  jobs:
  - job: BuildJob
    displayName: Build Application
    steps:
    - checkout: self
      fetchDepth: 1
    - task: UseDotNet@2
      displayName: Install .NET SDK
      inputs:
        packageType: sdk
        version: 8.x
    - script: |
        echo "Multi-line script"
        echo "Building application"
        dotnet build --configuration $(buildConfiguration)
      displayName: Build Solution

    - ${{ if eq(variables.buildConfiguration, 'Release') }}:
      - task: DotNetCoreCLI@2
        displayName: Run Tests
        inputs:
          command: test
          projects: '**/*Tests.csproj'
    - publish: $(Build.ArtifactStagingDirectory)
      artifact: drop
