name: Azure DevOps Expressions Test
# Compile-time expressions with literals

variables:
  someBoolean: ${{ true }}
  someNumber: ${{ -1.2 }}
  someString: ${{ 'a b c' }}
  someVersion: ${{ 1.2.3 }}
  # Runtime expressions
  isMain: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')]
  compileVar: ${{ variables.staticVar }}
# Function expressions

parameters:
- name: environment
  type: string
  default: dev
# Conditional expressions

variables:
- ${{ if eq(parameters.environment, 'prod') }}:
  - name: deploymentSlot
    value: production

- ${{ elseif eq(parameters.environment, 'staging') }}:
  - name: deploymentSlot
    value: staging

- ${{ else }}:
  - name: deploymentSlot
    value: development
# Each expressions

- ${{ each env in parameters.environments }}:
  - name: deploy_${{ env }}
    value: ${{ env }}
# Complex function expressions

stages:

- stage: Build
  condition: ${{ and(succeeded(), eq(variables.runTests, 'true')) }}

  jobs:
  - job: BuildJob
    condition: $[or(eq(variables['Build.Reason'], 'IndividualCI'), contains(variables['Build.SourceBranch'], 'feature/'))]
    steps:
    - script: echo ${{ format('Hello {0}!', parameters.name) }}
      condition: $[startsWith(variables['Build.SourceBranch'], 'refs/heads/')]
    - task: PublishResults@1
      condition: ${{ not(eq(parameters.skipTests, true)) }}
      inputs:
        testResults: $[join(';', parameters.testPaths)]

# Dependencies expressions  
- stage: Deploy
  dependsOn: Build
  condition: $[and(succeeded(), eq(stageDependencies.Build.BuildJob.outputs['setVar.shouldDeploy'], 'true'))]
